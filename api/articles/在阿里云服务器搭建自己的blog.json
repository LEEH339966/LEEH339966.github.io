{"title":"使用阿里云搭建自己的博客","slug":"在阿里云服务器搭建自己的blog","date":"2020-09-16T07:01:39.671Z","updated":"2020-12-03T03:47:13.860Z","comments":true,"path":"api/articles/在阿里云服务器搭建自己的blog.json","photos":[],"link":"","excerpt":"使用阿里云搭建自己的博客这篇文章主要介绍如何在阿里云服务器上搭建自己的博客，之前的博客是基于hexo和node.js搭建在github上的。笔者现在将网站迁移到自己的阿里云服务器上。","covers":["https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/003dd00372c3f98156512c62afe559cc.jpg","https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS85LzE0LzE2ZDJiNmVhNGRmNTQxNzg.png","https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS85LzE0LzE2ZDJiNmYzZDJmYmEzMmM.png","https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS85LzE0LzE2ZDJiNmZiZWI2ZmE1ODU.png","https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS85LzE0LzE2ZDJiNzAxMTkwOTNjYTk.png","https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/1501071-20181122105736040-226173388.png","https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/1501071-20181122105940672-275675563.png","https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/1501071-20181122110402217-1803182980.png","https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/1501071-20181122110521963-1905718990.png","https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/anquanzuguize.jpg"],"content":"<hr>\n<h1 id=\"使用阿里云搭建自己的博客\"><a href=\"#使用阿里云搭建自己的博客\" class=\"headerlink\" title=\"使用阿里云搭建自己的博客\"></a>使用阿里云搭建自己的博客</h1><p>这篇文章主要介绍如何在阿里云服务器上搭建自己的博客，之前的博客是基于hexo和node.js搭建在github上的。笔者现在将网站迁移到自己的阿里云服务器上。</p>\n<a id=\"more\"></a>\n\n<h4 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h4><p>在开始之前我们需要先购买阿里云的服务器，以及下载好hexo软件如何现在在之前的blog中有提到大家可以去看。</p>\n<p><img src=\"https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/003dd00372c3f98156512c62afe559cc.jpg\" alt=\"短发可爱\"></p>\n<h5 id=\"服务器的配置\"><a href=\"#服务器的配置\" class=\"headerlink\" title=\"服务器的配置\"></a>服务器的配置</h5><h6 id=\"搭建远程Git私库\"><a href=\"#搭建远程Git私库\" class=\"headerlink\" title=\"搭建远程Git私库\"></a>搭建远程<code>Git</code>私库</h6><ol>\n<li>登录到远程服务器，推荐使用<code>Xshell 5</code></li>\n<li>安装 git</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git --version // 如无，则安装</span><br><span class=\"line\">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel perl-devel</span><br><span class=\"line\">yum install -y git</span><br><span class=\"line\">123</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>创建用户并配置其仓库</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">useradd git</span><br><span class=\"line\">passwd git // 设置密码</span><br><span class=\"line\">su git // 这步很重要，不切换用户后面会很麻烦</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /home/git/</span><br><span class=\"line\">mkdir -p projects/blog // 项目存在的真实目录</span><br><span class=\"line\">mkdir repos &amp;&amp; <span class=\"built_in\">cd</span> repos</span><br><span class=\"line\">git init --bare blog.git // 创建一个裸露的仓库</span><br><span class=\"line\"><span class=\"built_in\">cd</span> blog.git/hooks</span><br><span class=\"line\">vi post-receive // 创建 hook 钩子函数，输入了内容如下</span><br><span class=\"line\">123456789</span><br><span class=\"line\"><span class=\"meta\">#!/bin/sh</span></span><br><span class=\"line\">git --work-tree=/home/git/projects/blog --git-dir=/home/git/repos/blog.git checkout -f</span><br><span class=\"line\">12</span><br></pre></td></tr></table></figure>\n\n<p>添加完毕后修改权限</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x post-receive</span><br><span class=\"line\"><span class=\"built_in\">exit</span> // 退出到 root 登录</span><br><span class=\"line\">chown -R git:git /home/git/repos/blog.git // 添加权限</span><br><span class=\"line\">123</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>测试<code>git仓库</code>是否可用，另找空白文件夹</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> git@server_ip:/home/git/repos/blog.git</span><br><span class=\"line\">1</span><br></pre></td></tr></table></figure>\n\n<p>如果能把空仓库拉下来，就说明 git 仓库搭建成功了</p>\n<p><img src=\"https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS85LzE0LzE2ZDJiNmVhNGRmNTQxNzg.png\"></p>\n<ol>\n<li>建立<code>ssh</code>信任关系，在<strong>本地电脑</strong></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-copy-id -i C:/Users/yourname/.ssh/id_rsa.pub git@server_ip</span><br><span class=\"line\">ssh git@server_ip // 测试能否登录</span><br><span class=\"line\">12</span><br></pre></td></tr></table></figure>\n\n<p><strong>注</strong>：此时的 ssh 登录 git 用户不需要密码！否则就<strong>有错</strong>，请仔细重复步骤 3-5</p>\n<ol>\n<li>为了安全起见禁用 git 用户的 shell 登录权限，从而只能用 git clone，git push 等登录</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cat /etc/shells // 查看 git-shell 是否在登录方式里面</span><br><span class=\"line\"><span class=\"built_in\">which</span> git-shell // 查看是否安装</span><br><span class=\"line\">vi /etc/shells</span><br><span class=\"line\">添加上2步显示出来的路劲，通常在 /usr/bin/git-shell</span><br><span class=\"line\">1234</span><br></pre></td></tr></table></figure>\n\n<p>修改<code>/etc/passwd</code>中的权限</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 将原来的</span><br><span class=\"line\">git:x:1000:1000::/home/git:/bin/bash</span><br><span class=\"line\"></span><br><span class=\"line\">// 修改为</span><br><span class=\"line\">git:x:1000:1000:,,,:/home/git:/usr/bin/git-shell</span><br><span class=\"line\">12345</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"搭建nginx服务器\"><a href=\"#搭建nginx服务器\" class=\"headerlink\" title=\"搭建nginx服务器\"></a>搭建<code>nginx</code>服务器</h3><ol>\n<li>下载并安装<code>nginx</code></li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/src</span><br><span class=\"line\">wget http://nginx.org/download/nginx-1.15.2.tar.gz</span><br><span class=\"line\">tar xzvf nginx-1.15.2.tar.gz</span><br><span class=\"line\"><span class=\"built_in\">cd</span> nginx-1.15.2</span><br><span class=\"line\">./configure // 如果后面还想要配置 SSL 协议，就执行后面一句！</span><br><span class=\"line\">./configure --prefix=/usr/<span class=\"built_in\">local</span>/nginx --with-http_stub_status_module --with-http_ssl_module --with-file-aio --with-http_realip_module</span><br><span class=\"line\">make &amp;&amp; make install</span><br><span class=\"line\"><span class=\"built_in\">alias</span> nginx=<span class=\"string\">&#x27;/usr/local/nginx/sbin/nginx&#x27;</span> // 为 nginx 取别名，后面可直接用</span><br><span class=\"line\">12345678</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>配置<code>nginx</code>文件</li>\n</ol>\n<p>先启动是否安装成功</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx // 直接来！浏览器查看 server_ip，默认是 80 端口</span><br><span class=\"line\">1</span><br></pre></td></tr></table></figure>\n\n<p>修改配置文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -s stop // 先停止nginx</span><br><span class=\"line\"><span class=\"built_in\">cd</span> /usr/<span class=\"built_in\">local</span>/nginx/conf</span><br><span class=\"line\">vi nginx.conf</span><br><span class=\"line\">修改 root 解析路径，如下图</span><br><span class=\"line\">同时将 user 改为 root 如下图，不然nginx无法访问 /home/git/project/blog</span><br><span class=\"line\">nginx -s reload</span><br><span class=\"line\">123456</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS85LzE0LzE2ZDJiNmYzZDJmYmEzMmM.png\"></p>\n<p><img src=\"https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS85LzE0LzE2ZDJiNmZiZWI2ZmE1ODU.png\"></p>\n<h2 id=\"四、发布\"><a href=\"#四、发布\" class=\"headerlink\" title=\"四、发布\"></a>四、发布</h2><p>至此我们就把本地和服务器的环境全部搭建完成，现在利用 hexo 配置文件进行链接</p>\n<h3 id=\"配置-config-yml文件\"><a href=\"#配置-config-yml文件\" class=\"headerlink\" title=\"配置_config.yml文件\"></a>配置<code>_config.yml</code>文件</h3><ol>\n<li>编辑 _config.yml 的 deploy 属性</li>\n</ol>\n<p><img src=\"https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/aHR0cHM6Ly91c2VyLWdvbGQtY2RuLnhpdHUuaW8vMjAxOS85LzE0LzE2ZDJiNzAxMTkwOTNjYTk.png\"></p>\n<ol>\n<li>在 package.json 中添加 npm 脚本</li>\n</ol>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;scripts&quot;: &#123;</span><br><span class=\"line\">  &quot;deploy&quot;: &quot;hexo clean &amp;&amp; hexo g -d&quot;,</span><br><span class=\"line\">  &quot;start&quot;: &quot;hexo clean &amp;&amp; hexo g &amp;&amp; hexo s&quot;</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"number\">1234</span></span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>链接！这下在本地调试就用<code>npm start</code>，调试好了就上传到服务器，美滋滋~快通过你的服务器 ip 访问吧</li>\n</ol>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run deploy</span><br></pre></td></tr></table></figure>\n\n<h5 id=\"解决nginx不能使用\"><a href=\"#解决nginx不能使用\" class=\"headerlink\" title=\"解决nginx不能使用\"></a>解决nginx不能使用</h5><p>1：进入 vim /etc/profile 文件</p>\n<p><img src=\"https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/1501071-20181122105736040-226173388.png\" alt=\"img\"></p>\n<p>2：添加配置 如下 </p>\n<p><img src=\"https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/1501071-20181122105940672-275675563.png\" alt=\"img\"></p>\n<p>添加配置之后重新启动服务器</p>\n<p><img src=\"https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/1501071-20181122110402217-1803182980.png\" alt=\"img\"></p>\n<p>重新启动nginx然后成功</p>\n<p><img src=\"https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/1501071-20181122110521963-1905718990.png\" alt=\"img\"></p>\n<h5 id=\"开放80端口\"><a href=\"#开放80端口\" class=\"headerlink\" title=\"开放80端口\"></a>开放80端口</h5><p>这时如果自己的ip地址还不能访问的话，可能是自己服务器相对应的端口没有打开。我们在阿里云的服务器的后台打开80（默认的端口）即可。</p>\n<p><img src=\"https://leehbucket1.oss-cn-beijing.aliyuncs.com/img/anquanzuguize.jpg\"></p>\n","categories":[{"name":"hexo网站搭建","slug":"hexo网站搭建","count":5,"path":"api/categories/hexo网站搭建.json"}],"tags":[{"name":"hexo+github搭建网站 -阿里云服务器","slug":"hexo-github搭建网站-阿里云服务器","count":1,"path":"api/tags/hexo-github搭建网站-阿里云服务器.json"}]}